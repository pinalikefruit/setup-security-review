import csv
import os

# Define the output file
output_file = 'contract_line_counts.txt'

# Open the CSV file generated by cloc
with open('temp_results.csv', 'r') as csv_file:
    reader = csv.reader(csv_file)
    # Skip the header row
    next(reader, None)
    
    total_lines = 0

    # Open the output file for writing
    with open(output_file, 'w') as output:
        # Process each row in the CSV file
        for row in reader:
            if len(row) > 3 and row[0] != 'SUM':
                # Extract the contract name and the number of source lines of code (NSLOC)
                contract_name = os.path.basename(row[1])  # Extracts the filename
                nsloc = row[4]  # Assuming NSLOC is in the 5th column

                # Write the contract name and NSLOC to the output file
                output.write(f"{contract_name}, {nsloc} \n")

            elif row[0] == 'SUM':  # If it's the summary row, capture the total
                    total_lines = row[4]

        # Write the total lines at the end of the file
        output.write(f"{total_lines}\n")

print(f"Results written to {output_file}")